<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Activity 2</title>
    <script src="https://raw.githack.com/SortableJS/Sortable/master/Sortable.js"></script>
    <style>
        @keyframes turnRight {
            0%{}
            100%{transform: rotate(90deg)}
        }
        @keyframes turnLeft {
            0%{}
            100%{transform: rotate(-90deg)}
        }
        @keyframes toRight {
            0%{}
            100%{transform: translateX(75px)}
        }
        @keyframes toLeft {
            0%{}
            100%{transform: translateX(-75px)}
        }
        @keyframes toUp {
            0%{}
            100%{transform: translateY(-75px)}
        }
        @keyframes toDown {
            0%{}
            100%{transform: translateY(75px)}
        }
        body{
            font-family: Vazirmatn;
        }
        #board{
            width: 30%;
            margin: auto;
            margin-right: 0px;
        }
        #board-wrap{
            width: 300px;
            height: 300px;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            background-color: black;
            border-collapse: collapse;
        }
        .cell{
            width: 72px;
            aspect-ratio: calc(1);
            background-color: #c6c6c6;
            border: 1px solid black;
            text-align: center;
            border-collapse: collapse;
            margin: auto;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 500;
        }
        #sprite{    /*   75px in X Axis     -     75px in Y Axis   */
            width: 58px;
            height: 58px;
            margin: auto;
            position: absolute;
            border-radius: 2px;

            /*animation-delay: 1s;*/
            animation-fill-mode: forwards;
            animation-duration: 2s;
            animation-timing-function: ease-out;
        }

        #activity-content{
            width: 100%;
            margin-top: 5%;
        }
        #activity-content-wrap{
            width: 100%;
            display: flex;
            flex-direction: row;
        }
        #activity-desc{
            width: 40%;
            margin: auto;
            margin-left: 0px;
        }
        #activity-desc-wrap{
            width: 100%;
            margin: auto;
            display: flex;
            flex-direction: column;
        }
        #instructions{
            width: 100%;
            /*background-color: #e5e87d;*/
        }
        #instructions-wrap{
            width: 100%;
            display: flex;
            flex-direction: column;
        }
        .instruction{
            width: fit-content;
            margin-left: auto;
            margin-bottom: 0.5%;
            border: 1.5px solid black;
            background-color: #f0f0f0;
            text-align: center;
            padding-right: 1%;
            padding-left: 1%;
            border-radius: 3px;
        }
        #instructions-answer{
            width: 80%;
            /*background-color: #e5e87d;*/
        }
        #instructions-answer-wrap{
            width: 100%;
            min-height: 50px;
            display: flex;
            flex-direction: column;
            background-color: #efac24;
            padding-top: 1%;
            padding-bottom: 1%;
            padding-right: 1%;
            /*margin-left: auto;*/
        }
        .instruction-answer{
            width: fit-content;
            margin-left: auto;
            margin-bottom: 0.5%;
            border: 1.5px solid black;
            background-color: #f0f0f0;
            text-align: center;
            padding-right: 1%;
            padding-left: 1%;
            border-radius: 3px;
        }
        #buttons-wrap{
            display: flex;
            flex-direction: row-reverse;
            margin: auto;
            margin-top: 5%;
            width: 20%;
        }
        #check-button{
            display: block;
            width: 40%;
            margin: auto;
            text-align: center;
            padding: 6px 0px 6px 0px;
            font-family: Vazirmatn;
            background-color: #f4ca20;
            border: 2px solid black;
            border-radius: 4px;
            color: black;
            font-weight: 700;
        }
        #reverse{
            display: block;
            width: 40%;
            margin: auto;
            text-align: center;
            padding: 6px 0px 6px 0px;
            font-family: Vazirmatn;
            background-color: #e8e8e8;
            border: 2px solid black;
            border-radius: 4px;
            color: black;
            font-weight: 700;
        }
        #reverse a{
            display: block;
            width: 100%;
            text-decoration: none;
            color: black;
        }
    </style>
</head>
<body>
<div id="activity-content">
    <div id="activity-content-wrap">
        <div id="board">
            <div id="board-wrap">
                <div id="cell-1" class="cell">
                    ۱
                    <img id="sprite" src="p3.png">
                </div>
                <div id="cell-2" class="cell">۲</div>
                <div id="cell-3" class="cell">۳</div>
                <div id="cell-4" class="cell">۴</div>
                <div id="cell-5" class="cell">۵</div>
                <div id="cell-6" class="cell">۶</div>
                <div id="cell-7" class="cell">۷</div>
                <div id="cell-8" class="cell">۸</div>
                <div id="cell-9" class="cell">۹</div>
                <div id="cell-10" class="cell">۱۰</div>
                <div id="cell-11" class="cell">۱۱</div>
                <div id="cell-12" class="cell">۱۲</div>
                <div id="cell-13" class="cell">۱۳</div>
                <div id="cell-14" class="cell">۱۴</div>
                <div id="cell-15" class="cell">۱۵</div>
                <div id="cell-16" class="cell">
                    ۱۶

                </div>
            </div>
        </div>
        <div id="activity-desc">
            <div id="activity-desc-wrap">
                <h3></h3>
                <p></p>

                <div id="instructions">
                    <div id="instructions-wrap">
                        <div class="instruction cmd-right">به راست بچرخ</div>
                        <div class="instruction cmd-left">به چپ بچرخ</div>
                        <div class="instruction cmd-forward">برو جلو</div>
                    </div>
                </div>
                <hr style="border: 1px solid black; width: 100%">
                <div id="instructions-answer">
                    <div id="instructions-answer-wrap">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="buttons-wrap">
        <button id="check-button" onclick="check_answer()">بررسی پاسخ</button>
        <button id="reverse">
            <a href="/journey">بازگشت</a>
        </button>
    </div>
</div>



    <script>
        Sortable.create(document.getElementById('instructions-wrap'), {
            group: {
                name: 'shared',
                pull: 'clone',
                put: false
            },
            animation: 250,
        });
        Sortable.create(document.getElementById('instructions-answer-wrap'), {
            group: 'shared',
            animation: 250,
        });

        Sortable.create(document.getElementById('board-wrap'), {
            animation: 250,
            filter: '.filtered'
        });

        function translate_sprite(distance, axis){
            let sprite = document.getElementById('sprite')
            if (axis === 'x') {
                if (distance > 0) {
                    sprite.style.animationName = ''
                    // Xtranslation_distance += distance
                    // sprite.style.transform = `translateX(${distance}px)`
                    sprite.style.animationName = 'toRight'
                    // sprite.style.transition = 'transform 2s'
                }
            } else {
                if (axis === 'y'){
                    if(distance > 0) {

                        // Ytranslation_distance += distance
                        // sprite.style.transform = `translateY(${distance}px)`
                        sprite.style.animationName = 'toDown'
                    }
                }
            }
        }

        function rotate_sprite(degree){
            let sprite = document.getElementById('sprite')
            sprite.style.transform = `rotateZ(${degree}deg)`
        }

        function check_answer(){
            let rotation_degree = 0
            let Xtranslation_distance = 0
            let Ytranslation_distance = 0
            let sprite = document.getElementById('sprite')

            let commands = document.querySelectorAll('#instructions-answer-wrap .instruction')
            for (let i = 0; i < commands.length; i++) {
                let startIndex = commands[i].className.indexOf('cmd') + 4
                let command = commands[i].className.substring(startIndex)
                if (command === 'forward'){
                    console.log('target-parent')
                    let cal = rotation_degree % 360
                    cal += 360
                    if (cal === 360){
                        Xtranslation_distance += 75
                        setTimeout(translate_sprite, 3000*i, 75, 'x')
                    } else {
                        if (cal === 90) {
                            Ytranslation_distance += 75
                            setTimeout(translate_sprite, 3000*i, 75, 'y')
                            // translate_sprite(Ytranslation_distance, 'y')
                        }
                        if (cal === 180) {
                            Xtranslation_distance += -75
                            setTimeout(translate_sprite, 3000*i, -75, 'x')
                            // translate_sprite(Xtranslation_distance, 'x')
                        }
                        if (cal === 270) {
                            Ytranslation_distance += -75
                            setTimeout(translate_sprite, 3000*i, -75, 'y')
                            // translate_sprite(Ytranslation_distance, 'y')
                        }
                    }
                } else {
                    if (command === 'right'){
                        rotation_degree += 90
                        setTimeout(rotate_sprite, 3000*i, rotation_degree)
                        // rotate_sprite(rotation_degree)
                    }
                    else {
                        if (command === 'left'){
                            rotation_degree -= 90
                            setTimeout(rotate_sprite, 3000*i, rotation_degree)
                            // rotate_sprite(rotation_degree)
                        }
                    }
                }
            }
        }
    </script>
</body>
</html>